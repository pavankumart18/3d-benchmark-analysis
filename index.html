<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Floor Plan Benchmark Dashboard</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9IiMyNTYzZWIiLz48cGF0aCBmaWxsPSIjZmZmIiBkPSJtMTYgNyAyIDcgNyAyLTcgMi0yIDctMi03LTctMiA3LTJaIi8+PC9zdmc+">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/styles/github-dark.min.css"
        crossorigin="anonymous">

    <!-- Custom CSS for Data Visualization -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href=".">3D Floor Plan Benchmark Dashboard</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <div class="ms-auto d-flex align-items-center">
                    <a href="story.html" class="btn btn-primary btn-sm me-3"
                        style="font-weight: 500; letter-spacing: 0.5px;">
                        <i class="bi bi-book-half me-1"></i> Read the Story
                    </a>
                </div>
                <!-- Always include a dark mode toggle -->
                <div class="nav-item dropdown ms-2" role="group" aria-label="Toggle dark mode" title="Toggle Dark Mode">
                    <button class="dark-theme-toggle btn btn-outline-light dropdown-toggle" type="button"
                        data-bs-toggle="dropdown" aria-expanded="false" aria-label="Toggle theme (auto)">
                        <i class="bi bi-circle-half"></i> <span class="d-lg-none ms-2">Toggle theme</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><button class="dropdown-item" data-bs-theme-value="light"><i
                                    class="me-2 bi bi-sun-fill"></i> Light</button></li>
                        <li><button class="dropdown-item" data-bs-theme-value="dark"><i
                                    class="me-2 bi bi-moon-stars-fill"></i> Dark</button></li>
                        <li><button class="dropdown-item" data-bs-theme-value="auto"><i
                                    class="me-2 bi bi-circle-half"></i> Auto</button></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4 pb-2">
        <h1 class="display-5 my-3 text-center fw-semibold text-dark">3D Floor Plan Benchmark Dashboard</h1>
        <h2 class="h6 text-center text-secondary fw-normal mb-3">A structured evaluation dashboard comparing 2D to 3D
            architectural representations</h2>

        <div class="mx-auto mb-4 text-center text-muted"
            style="max-width: 750px; font-size: 0.95rem; line-height: 1.5;">
            This analytical dashboard presents strict architectural verification metrics comparing generative 3D renders
            against original 2D floor plans. We track layout inaccuracies, structural fidelity, and spatial distortions
            across multiple models.
        </div>

        <div class="list-group mb-5 shadow-sm border-0" style="border-radius: 8px;">
            <button type="button"
                class="list-group-item list-group-item-action bg-white text-dark text-start px-4 py-3 fw-bold d-flex justify-content-between align-items-center"
                data-bs-toggle="modal" data-bs-target="#generationPromptModal"
                style="border-color: rgba(0,0,0,0.1) !important;">
                <span><i class="bi bi-chat-left-text text-primary me-2"></i> Generation Prompt</span>
                <i class="bi bi-chevron-down text-muted"></i>
            </button>
            <button type="button"
                class="list-group-item list-group-item-action bg-white text-dark text-start px-4 py-3 fw-bold d-flex justify-content-between align-items-center"
                data-bs-toggle="modal" data-bs-target="#evaluatorPromptModal"
                style="border-color: rgba(0,0,0,0.1) !important;">
                <span><i class="bi bi-robot text-success me-2"></i> Evaluator Prompt</span>
                <i class="bi bi-chevron-down text-muted"></i>
            </button>
        </div>

        <!-- Scoring Criteria Card -->
        <div class="card mb-5 border-0 shadow-sm"
            style="border-radius: 8px; overflow: hidden; border: 1px solid rgba(13, 110, 253, 0.4) !important;">
            <div class="card-header bg-primary text-white py-2 px-3 fw-bold d-flex align-items-center"
                style="font-size: 0.95rem;">
                <i class="bi bi-info-circle me-2"></i> Scoring Criteria Explained
            </div>
            <div class="card-body bg-white p-4">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <span class="badge bg-primary rounded fs-6 me-3 p-2 shadow-sm text-center"
                                style="min-width: 50px;">40%</span>
                            <div>
                                <div class="fw-bold text-dark d-flex align-items-center mb-1">Spatial Accuracy</div>
                                <div class="small text-muted" style="font-size: 0.8rem; line-height: 1.4;">Room
                                    placement
                                    (10), wall alignment (10), doors (10), windows (5), and proportions (5).</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <span class="badge bg-success rounded fs-6 me-3 p-2 shadow-sm text-center"
                                style="min-width: 50px;">25%</span>
                            <div>
                                <div class="fw-bold text-dark d-flex align-items-center mb-1">Structural Fidelity</div>
                                <div class="small text-muted" style="font-size: 0.8rem; line-height: 1.4;">Wall
                                    thickness
                                    (5), correct embedding (5), adjacency (5) and no hallucinated/missing rooms (10).
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <span class="badge bg-warning text-dark rounded fs-6 me-3 p-2 shadow-sm text-center"
                                style="min-width: 50px;">10%</span>
                            <div>
                                <div class="fw-bold text-dark d-flex align-items-center mb-1">Furniture & Interior
                                    Mapping
                                </div>
                                <div class="small text-muted" style="font-size: 0.8rem; line-height: 1.4;">Are major
                                    furniture items scaled (5) and positioned accurately (5)?</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <span class="badge text-white rounded fs-6 me-3 p-2 shadow-sm text-center"
                                style="min-width: 50px; background-color: #0dcaf0;">25%</span>
                            <div>
                                <div class="fw-bold text-dark d-flex align-items-center mb-1">Aesthetic Quality</div>
                                <div class="small text-muted" style="font-size: 0.8rem; line-height: 1.4;">Isometric
                                    camera
                                    (5), projection (5), lighting (5), clean geometry (5), and visual clarity (5).</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <span class="badge bg-dark rounded fs-6 me-3 p-2 shadow-sm text-center"
                                style="min-width: 50px;">100</span>
                            <div>
                                <div class="fw-bold text-dark d-flex align-items-center mb-1">Total Score</div>
                                <div class="small text-muted" style="font-size: 0.8rem; line-height: 1.4;">Weighted
                                    average
                                    of all criteria defined above (higher is better).</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-4">

        <!-- Summary Section (Leaderboard) -->
        <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="section-title h3 mb-0">Model Leaderboard (Overall Summary)</h2>
                <span class="badge bg-primary fs-6 rounded-pill px-3 py-2" id="total-tests-badge">0 Tests</span>
            </div>
            <div class="bg-body rounded shadow-sm border">
                <table class="table table-sm table-hover align-middle mb-0" id="summary-table"
                    style="font-size: 0.9em;">
                    <thead class="table-dark sticky-top">
                        <tr>
                            <th scope="col" class="sortable text-center text-nowrap" data-sort="model">Model</th>
                            <th scope="col" class="sortable text-end text-nowrap" data-sort="spatial">Spatial (40)</th>
                            <th scope="col" class="sortable text-end text-nowrap" data-sort="structural">Structural (25)
                            </th>
                            <th scope="col" class="sortable text-end text-nowrap" data-sort="furniture">Furniture (10)
                            </th>
                            <th scope="col" class="sortable text-end text-nowrap" data-sort="aesthetic">Aesthetic (25)
                            </th>
                            <th scope="col" class="sortable text-end fw-bold text-nowrap" data-sort="total">Total Score
                                (100)</th>
                        </tr>
                    </thead>
                    <tbody id="summary-tbody">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Detailed Breakdown Section -->
        <section class="mb-5">
            <h2 class="section-title h3 mb-3">Performance Breakdown (By Floor Plan)</h2>
            <p class="text-muted">Matrix view of floor plans vs models. Average total score among evaluators per
                plan/model. Click a cell/row to inspect details.</p>
            <div class="bg-body rounded shadow-sm border">
                <table class="table table-bordered table-sm table-hover align-middle mb-0 heatmap-table"
                    id="breakdown-table" style="font-size: 0.85em; table-layout: fixed; width: 100%;">
                    <thead class="table-dark sticky-top" id="breakdown-thead">
                        <!-- Populated via JS -->
                    </thead>
                    <tbody id="breakdown-tbody">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Insights Section -->
        <section class="mb-5">
            <h2 class="section-title h3 mb-3">AI Narrative Insights</h2>
            <div class="row g-4" id="insights-container">
                <!-- Populated via JS -->
            </div>
        </section>

        <!-- Evaluator Comparison Section -->
        <section class="mb-5">
            <h2 class="section-title h3 mb-3">Evaluator Cross-Comparison</h2>
            <p class="text-muted">How different LLM evaluators scored the same generative models. Values are average
                total scores.</p>
            <div class="bg-body rounded shadow-sm border">
                <table class="table table-sm table-hover align-middle mb-0 heatmap-table" id="evaluator-table"
                    style="font-size: 0.85em;">
                    <thead class="table-dark sticky-top" id="evaluator-thead">
                        <!-- Populated via JS -->
                    </thead>
                    <tbody id="evaluator-tbody">
                        <!-- Populated via JS -->
                    </tbody>
                </table>
            </div>
        </section>

    </div>

    <!-- Modal Layer -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title mb-0" id="detailModalLabel">Detailed Inspection</h5>
                        <small class="text-muted mt-1 d-block" id="modal-subtitle">Model vs Floor Plan Breakdown</small>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modal-body-content">
                    <!-- Populated via JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Image Lightbox Overlay -->
    <div id="lightboxOverlay" class="d-none align-items-center justify-content-center"
        style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.85); z-index: 9999; cursor: zoom-out;"
        onclick="window.closeLightbox()">
        <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-4"
            style="filter: invert(1) grayscale(100%) brightness(200%); width: 1.5rem; height: 1.5rem; z-index: 10000;"
            aria-label="Close" onclick="window.closeLightbox()"></button>
        <div id="lightboxContainer" class="d-flex flex-row align-items-center justify-content-center w-100 h-100"
            style="gap: 2rem; padding: 2rem; cursor: default;" onclick="event.stopPropagation()">
            <!-- Images injected via JS -->
        </div>
    </div>

    <script type="importmap">
    {
      "imports": {
        "asyncllm": "https://cdn.jsdelivr.net/npm/asyncllm@2.3.1",
        "bootstrap-alert": "https://cdn.jsdelivr.net/npm/bootstrap-alert@1.1.1",
        "bootstrap-llm-provider": "https://cdn.jsdelivr.net/npm/bootstrap-llm-provider@1.4.0",
        "highlight.js": "https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/+esm",
        "lit-html": "https://cdn.jsdelivr.net/npm/lit-html@3.3.1/+esm",
        "lit-html/directives/unsafe-html.js": "https://cdn.jsdelivr.net/npm/lit-html@3.3.1/directives/unsafe-html.js",
        "marked": "https://cdn.jsdelivr.net/npm/marked@13.0.3/+esm",
        "partial-json": "https://cdn.jsdelivr.net/npm/partial-json@0.1.7/+esm",
        "saveform": "https://cdn.jsdelivr.net/npm/saveform@1.4.0"
      }
    }
  </script>

    <script src="https://cdn.jsdelivr.net/npm/@gramex/ui@0.3.1/dist/dark-theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>


    <!-- Generation Prompt Modal -->
    <div class="modal fade" id="generationPromptModal" tabindex="-1" aria-labelledby="generationPromptModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white border-0">
                    <h5 class="modal-title fs-6 fw-bold" id="generationPromptModalLabel"><i
                            class="bi bi-chat-left-text me-2"></i>Generation Prompt</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4 text-dark text-start" style="background-color: #f8f9fa;">
                    <div class="p-3 border rounded shadow-sm bg-white"
                        style="white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.85rem; line-height: 1.6;">
                        Convert this 2D floor plan into a 3D isometric cutaway apartment render.

                        Strict Requirements:

                        • Preserve exact layout, wall placement, doors, and windows
                        • Do NOT redesign or reinterpret
                        • Maintain proportional scaling
                        • Keep room adjacency accurate

                        3D Style:

                        • Low-poly simplified geometry
                        • Clean block-style furniture
                        • Flat shading
                        • No photorealism
                        • Minimalistic architectural visualization
                        • Game-engine style (like a Three.js demo scene)
                        • No textures except simple flat colors

                        View & Camera:

                        • Isometric orthographic camera
                        • 45-degree angle
                        • Slight elevation
                        • Entire apartment visible
                        • Roof removed (cutaway view)
                        • All walls visible
                        • Centered composition

                        Lighting:

                        • Soft ambient light
                        • Very subtle shadows
                        • Even lighting
                        • No dramatic lighting

                        Background:

                        • Dark neutral background
                        • Floating apartment model
                        • No text labels
                        • No measurement lines
                        • No UI elements

                        High resolution architectural 3D render</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluator Prompt Modal -->
    <div class="modal fade" id="evaluatorPromptModal" tabindex="-1" aria-labelledby="evaluatorPromptModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-success text-white border-0">
                    <h5 class="modal-title fs-6 fw-bold" id="evaluatorPromptModalLabel"><i
                            class="bi bi-robot me-2"></i>Evaluator Prompt</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4 text-dark text-start" style="background-color: #f8f9fa;">
                    <div class="p-3 border rounded shadow-sm bg-white"
                        style="white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.85rem; line-height: 1.6;">
                        You are a strict architectural verification engine.

                        You are given:
                        1. Original 2D floor plan (first image)
                        2. Generated 3D isometric render (second image)

                        Your task:
                        Compare the 3D render against the 2D floor plan.

                        You must:
                        - Identify spatial inaccuracies
                        - Identify missing rooms
                        - Identify incorrect door placement
                        - Identify incorrect window placement
                        - Identify proportion distortion
                        - Identify hallucinated elements
                        - Evaluate aesthetic quality separately

                        Use the weighted rubric below. Be strict. Do not be lenient. Penalize structural deviations
                        heavily.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Scripts -->
    <script src="dashboard_data.js"></script>
    <script src="app.js"></script>
</body>

</html>